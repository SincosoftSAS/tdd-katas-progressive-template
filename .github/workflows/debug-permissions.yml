name: ğŸ” Debug Permissions

on:
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write
  actions: write

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: ğŸ”§ Setup GitHub CLI
        run: |
          gh auth login --with-token <<< "${{ secrets.GITHUB_TOKEN }}"

      - name: ğŸ” Check permissions
        run: |
          echo "ğŸ” Verificando permisos..."
          
          # Verificar acceso a la organizaciÃ³n
          echo "ğŸ“‹ Repos de la organizaciÃ³n:"
          gh repo list ${{ github.repository_owner }} --limit 5
          
          echo ""
          echo "ğŸ”‘ Token info:"
          gh auth status
          
          echo ""
          echo "ğŸ‘¤ Usuario actual:"
          gh api user --jq '.login'
          
          echo ""
          echo "ğŸ¢ Permisos en organizaciÃ³n:"
          gh api "orgs/${{ github.repository_owner }}/members/$USER" 2>/dev/null || echo "No es miembro visible"

      - name: ğŸ¯ Test specific student repo
        run: |
          # Probar con un repo especÃ­fico
          echo "ğŸ¯ Probando acceso a repo estudiante..."
          
          STUDENT_REPO="katas-tdd-didierymartinez"
          
          echo "ğŸ“‹ Info del repo:"
          gh repo view "${{ github.repository_owner }}/$STUDENT_REPO" --json name,owner,permissions || echo "No acceso al repo"
          
          echo ""
          echo "ğŸ”§ Intentando crear issue de prueba..."
          gh issue create \
            --repo "${{ github.repository_owner }}/$STUDENT_REPO" \
            --title "Test - Ignore" \
            --body "Prueba de permisos - ignorar" || echo "No se pudo crear issue"